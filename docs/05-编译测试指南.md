# ESP32-Gamepad ç¼–è¯‘æµ‹è¯•æŒ‡å—

## ğŸ¯ é¡¹ç›®å®ŒæˆçŠ¶æ€

âœ… **å·²å®Œæˆçš„ä»£ç æ¨¡å—**ï¼š

### 1. ä¸»ç¨‹åºæ¡†æ¶
- âœ… `main/main.c` - ç¨‹åºå…¥å£å’Œç³»ç»Ÿåˆå§‹åŒ–
- âœ… `main/gamepad_controller.h` - æ¸¸æˆæ‰‹æŸ„æ§åˆ¶å™¨æ¥å£
- âœ… `main/gamepad_controller.c` - æ¸¸æˆæ‰‹æŸ„æ§åˆ¶å™¨å®Œæ•´å®ç°

### 2. è“ç‰™HIDç»„ä»¶
- âœ… `components/bluetooth_hid/include/bluetooth_hid.h` - HIDåè®®æ¥å£
- âœ… `components/bluetooth_hid/src/bluetooth_hid.c` - HIDåè®®å®ç°ï¼ˆç®€åŒ–ç‰ˆï¼‰
- âœ… `components/bluetooth_hid/CMakeLists.txt` - ç»„ä»¶æ„å»ºé…ç½®

### 3. è®¾å¤‡æ§åˆ¶ç»„ä»¶
- âœ… `components/device_control/include/car_control.h` - å°è½¦æ§åˆ¶æ¥å£
- âœ… `components/device_control/src/car_control.c` - å°è½¦PWMæ§åˆ¶å®ç°
- âœ… `components/device_control/include/plane_control.h` - é£æœºæ§åˆ¶æ¥å£
- âœ… `components/device_control/src/plane_control.c` - é£æœºèˆµæœºæ§åˆ¶å®ç°
- âœ… `components/device_control/CMakeLists.txt` - ç»„ä»¶æ„å»ºé…ç½®

### 4. éœ‡åŠ¨åé¦ˆç»„ä»¶
- âœ… `components/vibration/include/vibration.h` - éœ‡åŠ¨æ§åˆ¶æ¥å£
- âœ… `components/vibration/src/vibration.c` - éœ‡åŠ¨åé¦ˆå®ç°
- âœ… `components/vibration/CMakeLists.txt` - ç»„ä»¶æ„å»ºé…ç½®

### 5. é¡¹ç›®é…ç½®æ–‡ä»¶
- âœ… `CMakeLists.txt` - ä¸»é¡¹ç›®æ„å»ºé…ç½®
- âœ… `sdkconfig.defaults` - ESP-IDFé»˜è®¤é…ç½®
- âœ… `setup_env.sh` - ç¯å¢ƒè®¾ç½®è„šæœ¬

## ğŸ”§ ç¼–è¯‘å‰å‡†å¤‡å·¥ä½œ

### ç¬¬ä¸€æ­¥ï¼šå®‰è£…ESP-IDFç¯å¢ƒ

```bash
# 1. åˆ›å»ºESPå¼€å‘ç›®å½•
mkdir -p ~/esp && cd ~/esp

# 2. å…‹éš†ESP-IDFä»“åº“
git clone --recursive https://github.com/espressif/esp-idf.git
cd esp-idf

# 3. åˆ‡æ¢åˆ°ç¨³å®šç‰ˆæœ¬
git checkout v5.1.2
git submodule update --init --recursive

# 4. å®‰è£…å·¥å…·é“¾
./install.sh esp32

# 5. è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæ¯æ¬¡æ–°ç»ˆç«¯éƒ½éœ€è¦ï¼‰
. ./export.sh

# 6. éªŒè¯å®‰è£…
idf.py --version
```

### ç¬¬äºŒæ­¥ï¼šå‡†å¤‡é¡¹ç›®ç¼–è¯‘

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /Users/xuqi/Proj/ESP32-Gamepad

# 2. è®¾ç½®ESP-IDFç¯å¢ƒ
source ~/esp/esp-idf/export.sh
# æˆ–è€…ä½¿ç”¨é¡¹ç›®æä¾›çš„è„šæœ¬
source setup_env.sh

# 3. é…ç½®ç›®æ ‡èŠ¯ç‰‡
idf.py set-target esp32

# 4. å¯é€‰ï¼šæ‰“å¼€é…ç½®èœå•è¿›è¡Œè‡ªå®šä¹‰é…ç½®
idf.py menuconfig
```

## ğŸš€ ç¼–è¯‘é¡¹ç›®

### åŸºæœ¬ç¼–è¯‘å‘½ä»¤

```bash
# æ¸…ç†ä¹‹å‰çš„æ„å»º
idf.py clean

# ç¼–è¯‘é¡¹ç›®
idf.py build
```

### é¢„æœŸç¼–è¯‘ç»“æœ

å¦‚æœç¼–è¯‘æˆåŠŸï¼Œåº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
```
Project build complete. To flash, run:
  idf.py flash
or
  idf.py -p (PORT) flash
```

### å¯èƒ½çš„ç¼–è¯‘é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ

#### 1. ç¯å¢ƒå˜é‡é—®é¢˜
**é”™è¯¯**: `idf.py: command not found`
**è§£å†³**: 
```bash
source ~/esp/esp-idf/export.sh
```

#### 2. ç»„ä»¶ä¾èµ–é—®é¢˜
**é”™è¯¯**: æ‰¾ä¸åˆ°å¤´æ–‡ä»¶æˆ–ç»„ä»¶
**è§£å†³**: æ£€æŸ¥ `components/*/CMakeLists.txt` ä¸­çš„ REQUIRES è®¾ç½®

#### 3. è“ç‰™é…ç½®é—®é¢˜
**é”™è¯¯**: è“ç‰™ç›¸å…³çš„ç¼–è¯‘é”™è¯¯
**è§£å†³**: ç¡®ä¿ `sdkconfig.defaults` ä¸­çš„è“ç‰™é…ç½®æ­£ç¡®

## ğŸ”§ çƒ§å½•å’Œæµ‹è¯•

### ç¡¬ä»¶è¿æ¥

#### ESP32å¼€å‘æ¿è¿æ¥
1. ä½¿ç”¨USBæ•°æ®çº¿è¿æ¥ESP32åˆ°ç”µè„‘
2. ç¡®è®¤é©±åŠ¨ç¨‹åºæ­£ç¡®å®‰è£…
3. æŸ¥çœ‹ä¸²å£è®¾å¤‡ï¼š`ls /dev/cu.*`

#### è¾“å‡ºè®¾å¤‡è¿æ¥ï¼ˆæµ‹è¯•æ—¶ï¼‰

**å°è½¦æ¨¡å¼å¼•è„šåˆ†é…**:
```
å·¦ç”µæœºï¼šPWM=18, DIR1=19, DIR2=21
å³ç”µæœºï¼šPWM=22, DIR1=23, DIR2=25
```

**é£æœºæ¨¡å¼å¼•è„šåˆ†é…**:
```
æ²¹é—¨èˆµæœºï¼šPIN=26
å‡é™èˆµæœºï¼šPIN=27
æ–¹å‘èˆµæœºï¼šPIN=14
å‰¯ç¿¼èˆµæœºï¼šPIN=12
```

### çƒ§å½•ç¨‹åº

```bash
# æŸ¥çœ‹å¯ç”¨ä¸²å£
ls /dev/cu.*

# çƒ§å½•ç¨‹åºï¼ˆæ›¿æ¢ä¸ºå®é™…ç«¯å£ï¼‰
idf.py -p /dev/cu.usbserial-xxxx flash

# çƒ§å½•å¹¶ç›‘æ§è¾“å‡º
idf.py -p /dev/cu.usbserial-xxxx flash monitor
```

### é¢„æœŸè¿è¡Œè¾“å‡º

```
I (123) MAIN: ===============================================
I (124) MAIN: ESP32 Gamepad Controller Starting...
I (125) MAIN: Version: 1.0.0
I (126) MAIN: Build Date: Jul  7 2025 xx:xx:xx
I (127) MAIN: ===============================================
I (128) MAIN: NVS Flash initialized
I (129) MAIN: Bluetooth initialized
I (130) GAMEPAD_CTRL: Initializing gamepad controller...
I (131) BT_HID: Initializing Bluetooth HID host (simplified version)...
I (132) VIBRATION: Initializing vibration control...
I (133) CAR_CTRL: Initializing car control...
I (134) PLANE_CTRL: Initializing plane control...
I (135) GAMEPAD_CTRL: Gamepad input task started
I (136) GAMEPAD_CTRL: Control output task started
I (137) GAMEPAD_CTRL: Gamepad controller initialized successfully
I (138) MAIN: System initialization completed
I (139) MAIN: System is ready for gamepad connection...
```

## ğŸ® åŠŸèƒ½æµ‹è¯•

### 1. åŸºç¡€ç³»ç»Ÿæµ‹è¯•
- âœ… ç³»ç»Ÿå¯åŠ¨å’Œåˆå§‹åŒ–
- âœ… è“ç‰™æ¨¡å—åˆå§‹åŒ–
- âœ… PWMè¾“å‡ºåŠŸèƒ½
- âœ… ä»»åŠ¡è°ƒåº¦æ­£å¸¸

### 2. æ¨¡æ‹Ÿæ‰‹æŸ„æµ‹è¯•
ç”±äºä½¿ç”¨ç®€åŒ–ç‰ˆHIDå®ç°ï¼Œå½“å‰ç‰ˆæœ¬æ”¯æŒï¼š
- âœ… è“ç‰™æ‰«æåŠŸèƒ½
- âœ… æ¨¡æ‹Ÿè®¾å¤‡è¿æ¥
- âœ… æ§åˆ¶æ¨¡å¼åˆ‡æ¢
- âœ… PWMè¾“å‡ºæ§åˆ¶

### 3. çœŸå®æ‰‹æŸ„è¿æ¥ï¼ˆéœ€è¦å®Œæ•´HIDå®ç°ï¼‰
- â³ éœ€è¦å®Œæ•´çš„HIDä¸»æœºåè®®æ ˆ
- â³ éœ€è¦æ‰‹æŸ„ç‰¹å®šçš„æ•°æ®æ ¼å¼è§£æ
- â³ éœ€è¦éœ‡åŠ¨åé¦ˆå®Œæ•´å®ç°

## ğŸ“ ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’

### çŸ­æœŸç›®æ ‡ï¼ˆ1-2å¤©ï¼‰
1. **å®Œå–„HIDåè®®å®ç°**
   - å®ç°çœŸæ­£çš„HIDä¸»æœºåŠŸèƒ½
   - æ·»åŠ æ‰‹æŸ„ç‰¹å®šæ•°æ®æ ¼å¼æ”¯æŒ
   - å®Œå–„éœ‡åŠ¨åé¦ˆæœºåˆ¶

2. **ç¡¬ä»¶æµ‹è¯•éªŒè¯**
   - è¿æ¥å®é™…ç”µæœºå’Œèˆµæœº
   - éªŒè¯PWMè¾“å‡ºæ­£ç¡®æ€§
   - æµ‹è¯•æ§åˆ¶å“åº”æ€§èƒ½

### ä¸­æœŸç›®æ ‡ï¼ˆ3-5å¤©ï¼‰
1. **åŠŸèƒ½å®Œå–„**
   - æ·»åŠ é…ç½®æ–‡ä»¶æ”¯æŒ
   - å®ç°å¤šç§æ‰‹æŸ„å…¼å®¹
   - ä¼˜åŒ–æ§åˆ¶ç®—æ³•

2. **ç¨³å®šæ€§æ”¹è¿›**
   - é”™è¯¯æ¢å¤æœºåˆ¶
   - è¿æ¥æ–­çº¿é‡è¿
   - å†…å­˜å’Œæ€§èƒ½ä¼˜åŒ–

## âœ… ç¼–è¯‘æµ‹è¯•æ¸…å•

åœ¨ç»§ç»­å¼€å‘å‰ï¼Œè¯·ç¡®è®¤ä»¥ä¸‹æ­¥éª¤ï¼š

- [ ] ESP-IDF v5.1.2 å®‰è£…å®Œæˆ
- [ ] ç¯å¢ƒå˜é‡è®¾ç½®æ­£ç¡® (`idf.py --version` å¯ç”¨)
- [ ] é¡¹ç›®ç¼–è¯‘æˆåŠŸ (`idf.py build`)
- [ ] ESP32ç¡¬ä»¶è¿æ¥æ­£å¸¸
- [ ] ç¨‹åºçƒ§å½•æˆåŠŸ (`idf.py flash`)
- [ ] ä¸²å£è¾“å‡ºæ­£å¸¸æ˜¾ç¤ºç³»ç»Ÿå¯åŠ¨ä¿¡æ¯
- [ ] æ‰€æœ‰ç»„ä»¶åˆå§‹åŒ–æˆåŠŸ

## ğŸ” æ•…éšœæ’é™¤

### ç¼–è¯‘é—®é¢˜
1. **ç¼ºå°‘å¤´æ–‡ä»¶**: æ£€æŸ¥ç»„ä»¶çš„ `CMakeLists.txt` ä¸­çš„ REQUIRES
2. **é“¾æ¥é”™è¯¯**: ç¡®ä¿æ‰€æœ‰ç»„ä»¶éƒ½åœ¨ä¸» `CMakeLists.txt` ä¸­è¢«å¼•ç”¨
3. **é…ç½®é”™è¯¯**: è¿è¡Œ `idf.py menuconfig` æ£€æŸ¥è“ç‰™é…ç½®

### è¿è¡Œæ—¶é—®é¢˜
1. **ç³»ç»Ÿé‡å¯**: æ£€æŸ¥å†…å­˜ä½¿ç”¨å’Œä»»åŠ¡å †æ ˆå¤§å°
2. **è“ç‰™é—®é¢˜**: ç¡®è®¤è“ç‰™é…ç½®å’Œæƒé™è®¾ç½®
3. **PWMæ— è¾“å‡º**: æ£€æŸ¥å¼•è„šé…ç½®å’Œç¡¬ä»¶è¿æ¥

---

**é¡¹ç›®çŠ¶æ€**: ğŸŸ¢ åŸºç¡€æ¡†æ¶å®Œæˆï¼Œå¯ä»¥ç¼–è¯‘å’ŒåŸºç¡€æµ‹è¯•  
**ä¸‹ä¸€é‡Œç¨‹ç¢‘**: å®Œæ•´HIDåè®®å®ç°å’Œç¡¬ä»¶æµ‹è¯•  

*æ›´æ–°æ—¶é—´ï¼š2025å¹´7æœˆ7æ—¥*
