# ESP32-Gamepad æ•…éšœæ’é™¤æŒ‡å—

## ğŸš¨ å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### ç¯å¢ƒé…ç½®é—®é¢˜

#### é—®é¢˜1: ESP-IDFæœªæ‰¾åˆ°
```
âŒ æœªæ‰¾åˆ°ESP-IDFå®‰è£…ç›®å½•
è¯·å…ˆå®‰è£…ESP-IDFï¼Œå‚è€ƒ docs/01-å¼€å‘ç¯å¢ƒæ­å»º.md
```

**è§£å†³æ–¹æ¡ˆ**:
1. **è‡ªåŠ¨å®‰è£…**ï¼ˆæ¨èï¼‰:
   ```bash
   ./install_esp_idf.sh
   ```

2. **æ‰‹åŠ¨æ£€æŸ¥ESP-IDFå®‰è£…**:
   ```bash
   # æ£€æŸ¥å¸¸è§å®‰è£…ä½ç½®
   ls -la ~/esp/esp-idf
   ls -la /opt/esp-idf
   ls -la ~/.espressif/esp-idf
   ```

3. **æ‰‹åŠ¨è®¾ç½®ç¯å¢ƒå˜é‡**:
   ```bash
   export IDF_PATH="/path/to/your/esp-idf"
   source setup_env.sh
   ```

#### é—®é¢˜2: `return` å‘½ä»¤é”™è¯¯
```
./setup_env.sh: line 19: return: can only `return' from a function or sourced script
```

**è§£å†³æ–¹æ¡ˆ**:
ä½¿ç”¨ `source` å‘½ä»¤è€Œä¸æ˜¯ç›´æ¥æ‰§è¡Œ:
```bash
# æ­£ç¡®æ–¹å¼
source setup_env.sh

# æˆ–è€…
. setup_env.sh

# é”™è¯¯æ–¹å¼ï¼ˆä¼šå¯¼è‡´returné”™è¯¯ï¼‰
./setup_env.sh
```

#### é—®é¢˜3: `idf.py` å‘½ä»¤æœªæ‰¾åˆ°
```
zsh: command not found: idf.py
```

**è§£å†³æ–¹æ¡ˆ**:
1. **é‡æ–°æ¿€æ´»ESP-IDFç¯å¢ƒ**:
   ```bash
   source ~/esp/esp-idf/export.sh
   # æˆ–è€…å¦‚æœé…ç½®äº†åˆ«å
   get_idf
   ```

2. **æ£€æŸ¥PATHç¯å¢ƒå˜é‡**:
   ```bash
   echo $PATH | grep esp
   which idf.py
   ```

3. **é‡æ–°å®‰è£…ESP-IDFå·¥å…·**:
   ```bash
   cd ~/esp/esp-idf
   ./install.sh esp32
   source export.sh
   ```

### ç¼–è¯‘é—®é¢˜

#### é—®é¢˜4: ç¼–è¯‘å¤±è´¥ - ç¼ºå°‘ç»„ä»¶
```
CMake Error: Could not find component 'bluetooth_hid'
```

**è§£å†³æ–¹æ¡ˆ**:
1. **æ£€æŸ¥é¡¹ç›®ç»“æ„**:
   ```bash
   # ç¡®ä¿componentsç›®å½•å­˜åœ¨
   ls -la components/
   
   # æ£€æŸ¥ç»„ä»¶CMakeLists.txt
   cat components/bluetooth_hid/CMakeLists.txt
   ```

2. **é‡æ–°ç”Ÿæˆæ„å»ºæ–‡ä»¶**:
   ```bash
   rm -rf build
   idf.py clean
   idf.py build
   ```

#### é—®é¢˜5: å¤´æ–‡ä»¶æ‰¾ä¸åˆ°
```
fatal error: 'esp_err.h' file not found
```

**è§£å†³æ–¹æ¡ˆ**:
1. **ç¡®ä¿ESP-IDFç¯å¢ƒå·²æ¿€æ´»**:
   ```bash
   source ~/esp/esp-idf/export.sh
   echo $IDF_PATH
   ```

2. **æ£€æŸ¥ESP-IDFç‰ˆæœ¬å…¼å®¹æ€§**:
   ```bash
   idf.py --version
   # æ¨èä½¿ç”¨ v5.0+ ç‰ˆæœ¬
   ```

#### é—®é¢˜6: å†…å­˜ä¸è¶³
```
ERROR: Not enough memory to build
```

**è§£å†³æ–¹æ¡ˆ**:
1. **å¢åŠ è™šæ‹Ÿå†…å­˜**ï¼ˆå¦‚æœå¯èƒ½ï¼‰
2. **ä½¿ç”¨å¢é‡ç¼–è¯‘**:
   ```bash
   idf.py build
   # è€Œä¸æ˜¯ idf.py clean && idf.py build
   ```

3. **å…³é—­ä¸å¿…è¦çš„åº”ç”¨ç¨‹åº**

### ç¡¬ä»¶è¿æ¥é—®é¢˜

#### é—®é¢˜7: ä¸²å£è®¾å¤‡æœªæ‰¾åˆ°
```
âŒ è®¾å¤‡æœªè¿æ¥æˆ–ç«¯å£ä¸æ­£ç¡®: /dev/ttyUSB0
```

**è§£å†³æ–¹æ¡ˆ**:
1. **æŸ¥æ‰¾å¯ç”¨ä¸²å£**:
   ```bash
   # macOS
   ls /dev/cu.*
   
   # Linux
   ls /dev/ttyUSB* /dev/ttyACM*
   
   # æŸ¥çœ‹è®¾å¤‡ä¿¡æ¯
   system_profiler SPUSBDataType | grep -i "cp210\|ch340\|ft232"
   ```

2. **æŒ‡å®šæ­£ç¡®ä¸²å£**:
   ```bash
   # ä½¿ç”¨æ„å»ºè„šæœ¬
   ./build.sh -p /dev/cu.usbserial-0001 flash
   
   # æˆ–ç›´æ¥ä½¿ç”¨idf.py
   idf.py -p /dev/cu.usbserial-0001 flash
   ```

3. **æ£€æŸ¥USBé©±åŠ¨**:
   - ç¡®ä¿å®‰è£…äº†æ­£ç¡®çš„USBè½¬ä¸²å£é©±åŠ¨
   - å¸¸è§èŠ¯ç‰‡: CP2102, CH340, FT232

#### é—®é¢˜8: çƒ§å½•å¤±è´¥
```
Failed to connect to ESP32
```

**è§£å†³æ–¹æ¡ˆ**:
1. **æ£€æŸ¥è¿æ¥**:
   - ç¡®ä¿USBçº¿è¿æ¥æ­£å¸¸
   - å°è¯•ä¸åŒçš„USBç«¯å£
   - æ£€æŸ¥ESP32å¼€å‘æ¿ç”µæº

2. **è¿›å…¥çƒ§å½•æ¨¡å¼**:
   - æŒ‰ä½BOOTæŒ‰é’®
   - çŸ­æŒ‰RESETæŒ‰é’®
   - é‡Šæ”¾BOOTæŒ‰é’®

3. **é™ä½æ³¢ç‰¹ç‡**:
   ```bash
   idf.py -p /dev/cu.usbserial-0001 -b 115200 flash
   ```

### è“ç‰™è¿æ¥é—®é¢˜

#### é—®é¢˜9: è“ç‰™åˆå§‹åŒ–å¤±è´¥
```
ERROR: Bluetooth init failed
```

**è§£å†³æ–¹æ¡ˆ**:
1. **æ£€æŸ¥è“ç‰™é…ç½®**:
   ```bash
   idf.py menuconfig
   # è¿›å…¥ Component config -> Bluetooth
   # ç¡®ä¿å¯ç”¨äº†Bluetoothå’ŒBLE
   ```

2. **æ£€æŸ¥åˆ†åŒºè¡¨**:
   ```bash
   # ç¡®ä¿æœ‰è¶³å¤Ÿçš„flashç©ºé—´ç”¨äºè“ç‰™
   cat partitions.csv
   ```

#### é—®é¢˜10: æ‰‹æŸ„è¿æ¥å¤±è´¥
```
WARNING: Controller connection failed
```

**è§£å†³æ–¹æ¡ˆ**:
1. **æ£€æŸ¥æ‰‹æŸ„å…¼å®¹æ€§**:
   - ç¡®ä¿æ‰‹æŸ„æ”¯æŒè“ç‰™HIDæ¨¡å¼
   - å°è¯•é‡ç½®æ‰‹æŸ„è“ç‰™é…å¯¹

2. **è°ƒè¯•è¿æ¥è¿‡ç¨‹**:
   ```bash
   # å¯ç”¨è¯¦ç»†æ—¥å¿—
   idf.py menuconfig
   # Component config -> Log output -> Default log verbosity -> Debug
   ```

### æ€§èƒ½é—®é¢˜

#### é—®é¢˜11: å“åº”å»¶è¿Ÿé«˜
**è§£å†³æ–¹æ¡ˆ**:
1. **è°ƒæ•´ä»»åŠ¡ä¼˜å…ˆçº§**:
   - åœ¨ `gamepad_config.ini` ä¸­è°ƒæ•´ä»»åŠ¡ä¼˜å…ˆçº§
   - æé«˜è¾“å…¥å¤„ç†ä»»åŠ¡çš„ä¼˜å…ˆçº§

2. **ä¼˜åŒ–è“ç‰™å‚æ•°**:
   ```ini
   [bluetooth]
   scan_window = 50
   scan_interval = 50
   connection_interval = 10
   ```

#### é—®é¢˜12: å†…å­˜ä½¿ç”¨è¿‡é«˜
**è§£å†³æ–¹æ¡ˆ**:
1. **ç›‘æ§å†…å­˜ä½¿ç”¨**:
   ```bash
   # åœ¨ä¸²å£ç›‘æ§ä¸­æŸ¥çœ‹å†…å­˜ä¿¡æ¯
   idf.py monitor
   ```

2. **è°ƒæ•´æ ˆå¤§å°**:
   ```c
   // åœ¨ä»»åŠ¡é…ç½®ä¸­å‡å°‘æ ˆå¤§å°
   .stack_size = 2048  // è€Œä¸æ˜¯ 4096
   ```

## ğŸ”§ è°ƒè¯•å·¥å…·å’ŒæŠ€å·§

### 1. å¯ç”¨è¯¦ç»†æ—¥å¿—
```bash
# ä¸´æ—¶å¯ç”¨
export ESP_LOG_LEVEL=DEBUG

# æˆ–åœ¨ä»£ç ä¸­è®¾ç½®
esp_log_level_set("*", ESP_LOG_DEBUG);
```

### 2. ä½¿ç”¨ä¸²å£ç›‘æ§
```bash
# åŸºæœ¬ç›‘æ§
idf.py monitor

# å¸¦è¿‡æ»¤çš„ç›‘æ§
idf.py monitor | grep "ERROR\|WARNING"

# ä¿å­˜æ—¥å¿—åˆ°æ–‡ä»¶
idf.py monitor > debug.log 2>&1
```

### 3. å†…å­˜åˆ†æ
```bash
# æ˜¾ç¤ºå†…å­˜ä½¿ç”¨æƒ…å†µ
idf.py size
idf.py size-files

# è¿è¡Œæ—¶å†…å­˜ç›‘æ§
# åœ¨ä»£ç ä¸­æ·»åŠ :
// heap_caps_print_heap_info(MALLOC_CAP_8BIT);
```

### 4. æ€§èƒ½åˆ†æ
```bash
# å¯ç”¨æ€§èƒ½ç›‘æ§
# åœ¨ gamepad_config.ini ä¸­è®¾ç½®:
# enable_performance_monitor = true
```

## ğŸ“ è·å–å¸®åŠ©

### 1. æ£€æŸ¥æ–‡æ¡£
- [å¼€å‘ç¯å¢ƒæ­å»º](01-å¼€å‘ç¯å¢ƒæ­å»º.md)
- [å¿«é€Ÿå¼€å§‹æŒ‡å—](03-å¿«é€Ÿå¼€å§‹æŒ‡å—.md)
- [ç¼–è¯‘æµ‹è¯•æŒ‡å—](05-ç¼–è¯‘æµ‹è¯•æŒ‡å—.md)

### 2. æ£€æŸ¥æ—¥å¿—
```bash
# æŸ¥çœ‹æ„å»ºæ—¥å¿—
cat build.log

# æŸ¥çœ‹è¿è¡Œæ—¥å¿—
idf.py monitor
```

### 3. ç¤¾åŒºæ”¯æŒ
- [ESP-IDFå®˜æ–¹æ–‡æ¡£](https://docs.espressif.com/projects/esp-idf/)
- [ESP32ç¤¾åŒºè®ºå›](https://www.esp32.com/)
- [GitHub Issues](https://github.com/espressif/esp-idf/issues)

### 4. æŠ¥å‘Šé—®é¢˜
å¦‚æœé‡åˆ°é¡¹ç›®ç‰¹å®šçš„é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. æ“ä½œç³»ç»Ÿå’Œç‰ˆæœ¬
2. ESP-IDFç‰ˆæœ¬
3. å®Œæ•´çš„é”™è¯¯æ—¥å¿—
4. å¤ç°æ­¥éª¤
5. ç¡¬ä»¶é…ç½®ä¿¡æ¯

---

**æç¤º**: å¤§éƒ¨åˆ†é—®é¢˜éƒ½å¯ä»¥é€šè¿‡é‡æ–°è®¾ç½®ç¯å¢ƒå’Œæ¸…ç†æ„å»ºç¼“å­˜è§£å†³ï¼š
```bash
source ~/esp/esp-idf/export.sh
rm -rf build
idf.py clean
idf.py build
```
